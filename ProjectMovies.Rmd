---
title: "test"
output: html_document
date: "2025-02-20"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(janitor)
library(dplyr)
library(ggplot2)
```


## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
netflix <- read_csv("data/netflix_titles.csv")
```

```{r}
imdb_top_1000 <- read_csv("data/imdb_top_1000.csv") %>% clean_names()
```

```{r}
disney <- read_csv("data/movie_infoboxes_clean_final.csv") %>%  clean_names()
```



Laiba:

```{r}
colnames(netflix)
```
```{r}
summary(netflix)
```
```{r}
glimpse(netflix)


```


```{r}
netflix_clean <- netflix %>% 
  separate(date_added, into= c("day_added","year_added"), sep = ", ") %>% 
  mutate(
    num = as.numeric(str_extract(duration, "\\d+")),  
    duration_mins = case_when(
      str_detect(duration, "Season") ~ num * 450,  
      str_detect(duration, "min") ~ num)) %>%
  select(-num, -show_id)
  
  
```

Find the countries with the most International Movies.
```{r}
netflix %>% 
  filter(str_detect(listed_in,"International Movies")) %>% 
  group_by(country) %>% 
  summarize(total=n_distinct(title)) %>% 
  arrange(-total) %>% 
  top_n(11, total) %>% 
  ggplot(aes(x=reorder(country, total), y=total, fill=country)) +
  geom_col()+
  coord_flip()+
  labs(title="Top 10 Countries with International Movies on Netflix",
       x="Country",
       y="Movies")

```

In the country with the most international movies, what year were the first movies from this country added?
```{r}
netflix_clean %>% 
  filter(country=="India") %>% 
  arrange(year_added) %>% 
  select(title, year_added)
```



```{r}
netflix %>% 
  filter(country=="United States") %>% 
  filter(rating %in% c("UR","TV-Y7-FV", "TV-Y", "TV-PG", "TV-MA", "TV-G", "TV-14", "R", "PG-13", "PG", "NR", "NC-17", "G" )) %>% 
  ggplot(aes(x=rating, fill=rating))+
  geom_bar()+
  coord_flip()+
  labs(title= "Number of Movies by Rating in the United States")
```
```{r}
netflix %>% 
  filter(country!="United States") %>% 
  filter(rating %in% c("UR","TV-Y7-FV", "TV-Y", "TV-PG", "TV-MA", "TV-G", "TV-14", "R", "PG-13", "PG", "NR", "NC-17", "G" )) %>% 
  ggplot(aes(x=rating, fill=rating))+
  geom_bar()+
  coord_flip()+
  labs(title= "Number of Movies by Rating",
       x="Rating",
       y="Count")
```


```{r}
netflix_clean %>%
  mutate(year_added = as.numeric(year_added)) %>% 
  filter(!is.na(year_added)) %>%
  group_by(year_added) %>%
  summarise(count = n()) %>% 
  ggplot(aes(x = year_added, y = count)) +
  geom_line(color = "pink", size = 0.5) +
  geom_point(color = "red", size = 2) +
  labs(title = "Netflix Content Growth Over Time", x = "Year", y = "Number of Titles Released") +
  theme_minimal()
```



```{r}
 netflix %>%
  select(title, rating, release_year) %>% 
  filter(rating %in% c("UR","TV-Y7-FV", "TV-Y", "TV-PG", "TV-MA", "TV-G", "TV-14", "R", "PG-13", "PG", "NR", "NC-17", "G" )) %>% 
  mutate(decade = floor(release_year / 10) * 10) %>% 
  count(decade, rating, sort = TRUE) %>% 
  ggplot(aes(x=as.factor(decade), y=n, fill=rating))+
    geom_col()+
  scale_y_log10()+
  labs(title="Ratings and Releases by Decade",
       y="Count (log 10)",
       x="Decade",
       fill="Rating")

```
Show a Distribution of Moview Durations.
```{r}
# density plot of durations
netflix_clean %>% 
  filter(type=="Movie") %>% 
ggplot(aes(x = duration_mins)) +
  geom_density(fill = "lightblue", alpha = 0.6) +
  labs(title = "Distribution of Movie Durations", x = "Duration (mins)", y = "Density") +
  theme_minimal()
```

Display the Number of Netflix Releases by Year and Month.
```{r}
# heatmap of releases, fix axis titles on x
netflix_clean %>%
  separate(day_added, into= c("month_added","date_added"), sep = " ") %>% 
  count(year_added, month_added) %>% 
ggplot(aes(x = month_added, y = year_added, fill = n)) +
  geom_tile() +
  labs(title = "Netflix Releases by Year and Month", x = "Month", y = "Year", fill = "Number of Titles") +
  theme_classic()+
  coord_flip()+
  theme(axis.text.x=element_text(angle=60, hjust=1))
```

Show the Range of Movie Durations by Decade.

```{r}
netflix_clean %>%
  filter(type=="Movie") %>% 
  mutate(decade = floor(release_year / 10) * 10) %>%
  ggplot(aes(x = factor(decade), y = duration_mins, fill = factor(decade))) +
  geom_boxplot(alpha = 0.7) +
  labs(title = "Range of Movie Duration by Decade", x = "Decade", y = "Duration (minutes)") +
  theme_minimal()
```

```{r}
netflix_clean %>% 
  # actor with most netflix appearances
```






Hareem:
```{r}

```

cleaning:
```{r}
imdb_top_1000 <- imdb_top_1000 %>% 
  select(-c(poster_link, certificate,)) #removing unnecessary columns
```

```{r}
imdb_top_1000 <- imdb_top_1000 %>% 
  unite("stars", star1, star2, star3, star4, sep = ",") #joining columns
```


Actors in the most top 1000 movies:
```{r}
top_7 <- imdb_top_1000 %>% 
  separate_rows(stars, sep = ", ") %>%  
  count(stars) %>%         
  slice_max(n, n = 7) %>% 
  arrange(-n, stars)

top_7
```

imdb rating average for each of the top 7:
```{r}
imdb_top_1000 %>% 
  separate_rows(stars, sep = ", ") %>%
  filter(stars %in% top_7$stars) %>%  # Filter to include only top 7 actors
  group_by(stars) %>%                      # Group by actor
  summarise(average_rating = mean(imdb_rating, na.rm = T)) %>% 
  arrange(-average_rating)
```

Separating based off of which movies contain the word "love" and "war" in their overviews. 

From the imdb top 1000 movies, are movies about love or war higher rated and which earns more? Over time, which is more popular; war or love? 
```{r}
love_and_war <- imdb_top_1000 %>% 
  filter(str_detect(overview, " love | war ")) %>% 
  select(overview, series_title, released_year, runtime, stars, imdb_rating, gross) %>% 
  mutate(movie_type = case_when(
    str_detect(overview, fixed("love")) ~ "Love",
    str_detect(overview, fixed("war")) ~ "War"
  ))
```

```{r}
love <- love_and_war %>% 
  filter(str_detect(overview, " love ")) %>% 
```

```{r}
war <- love_and_war %>% 
  filter(str_detect(overview, " war "))
```


Which has the higher rating?
```{r}
love_and_war %>% 
  filter(str_detect(overview, " love ")) %>% 
  summarize(love_ratings = mean(imdb_rating)) 
```

```{r}
love_and_war %>% 
  filter(str_detect(overview, " war ")) %>% 
  summarize(war_ratings = mean(imdb_rating)) 
```

Which earns more money?
```{r}
love_and_war %>% 
  filter(str_detect(overview, " love ")) %>% 
  summarize(love_money = mean(gross, na.rm=T))
```
```{r}
love_and_war %>% 
  filter(str_detect(overview, " war ")) %>% 
  summarize(war_money = mean(gross, na.rm=T))
```
```{r}
movie_trends <- love_and_war %>%
  group_by(released_year, movie_type) %>%
  summarise(movie_count = n(), .groups = 'drop')
```



Cleaning disney:
```{r}
glimpse(disney)
```

```{r}
disney <- disney %>% 
  select(-c(26:60)) #remove unnecessary columns
```

```{r}
disney <- disney %>%
  mutate(release_year = coalesce(release_dates, release_date)) %>%
  select(-release_dates, -release_date)  #combine both release date columns
```

```{r}
disney <- disney %>% 
  rename(imdb_rating="im_db_rating")
```


```{r}
disney_ratings_over_time <- disney %>% 
  select(imdb_rating, release_year) %>% 
  separate(release_year, into=c("month_day", "year"), sep = ", ") %>% 
  select(-month_day) %>% 
  mutate(year = as.numeric(str_extract(year, "^\\d{4}")))
```


```{r}
disney_avg_ratings <- disney_ratings_over_time %>%
  mutate(year = as.numeric(year),
    imdb_rating = as.numeric(imdb_rating)) %>% 
  filter(!is.na(year)) %>%  
  group_by(year) %>%       
  summarise(avg_rating = round(mean(imdb_rating, na.rm = TRUE), 2))
```


```{r}
ggplot(disney_avg_ratings, aes(x = year, y = avg_rating)) +
  geom_line(color="lightsteelblue1") +  
  geom_point(color="lightsteelblue1") + 
  scale_x_continuous(breaks = seq(min(disney_avg_ratings$year), max(disney_avg_ratings$year), by = 2)) +
  labs(title = "Average Disney Ratings Over the Years",
       x = "Year",
       y = "Average Rating") +
theme_minimal() +
theme(
    axis.text.x = element_text(angle = 75, hjust = 1, color="royalblue"),  
    axis.title.x = element_text(size = 12, color = "royalblue", face = "bold"), 
    axis.title.y = element_text(size = 12, color = "royalblue", face = "bold"), 
    axis.text.y = element_text(color="royalblue"), 
    plot.title = element_text(face = "bold", size = 16, color = "royalblue"),  
    panel.grid.major = element_line(color = "aliceblue"),  
    panel.grid.minor = element_blank()  
  )

#big dip at 2023
```

Worst Movies:

Recently: 2023
```{r}
disney_avg_ratings %>% 
  filter(year == "2023")

#saw a big dip in 2023 with a rating of 5.97 
```
Worst Movie of 2023:
```{r}
disney %>% 
  filter(str_detect(release_year, "2023")) %>% 
  select(title, imdb_rating) %>% 
  arrange(imdb_rating) %>% 
  head(n, n=1)

#Peter Pan & Wendy with a rating of 4.4
```

Overall:
```{r}
disney %>% 
  select(title, imdb_rating, release_year) %>% 
  mutate(imdb_rating= as.numeric(imdb_rating)) %>% 
  arrange(imdb_rating)

#2009, imdb_rating of 1.6, Jonas Brothers:The 3D Concert Experience
#2008, rating of 2.7, Hannah Montana and Miley Cyrus:Best of Both Worlds Concert
#2003, rating of 3.4, George of the Jungle 2
```




Is there a correlation between budget and rating? 

```{r}
disney_budget <- disney %>% 
  filter(!is.na(budget)) %>% 
  select(title, budget, imdb_rating, release_year) 
```

```{r}
rows_to_remove <- c(1:17, 19, 20, 28, 32, 44, 45, 46, 47, 54, 59, 62, 64, 65, 98, 99, 
                    105, 106, 115, 128:132, 144, 145, 151, 161, 175, 178, 
                    217, 218, 224:229, 246, 248:250, 264, 279, 287, 288, 
                    302, 303, 304)
```

```{r}
disney_budget_clean <- disney_budget[-rows_to_remove, ] 
```

```{r}
rows_to_remove2 <- c(19, 20, 22, 47, 60, 132, 167, 171, 247)
```

```{r}
disney_budget_clean <- disney_budget[-rows_to_remove2, ] 
```


```{r}
disney_budget_clean <- disney_budget_clean %>%
  mutate(budget = as.numeric(gsub("[\\$, million]", " ", budget)
  ))

#Removed "$" and "million", then converted to numeric
```

```{r}
ggplot(disney_budget_clean, aes(x = budget, y = imdb_rating)) +
  geom_point(color = "pink", size = 2) +  
  labs(
    title = "Correlation Between Budget and IMDb Rating",
    x = "Budget (in millions)",
    y = "IMDb Rating"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 16, color = "pink"),
    axis.title.x = element_text(size = 14, color = "pink"),
    axis.title.y = element_text(size = 14, color = "pink")
  )
```
















```{r}
write.csv(netflix_clean, "data/netflix_clean.csv", row.names=FALSE)
```















